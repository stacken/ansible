---

- include: redhat.yml
  when: ansible_os_family == "RedHat"

- name: Enable glusterd
  service: name=glusterd enabled=yes state=started

- name: Enable glusterfsd
  service: name=glusterfsd enabled=yes state=started

- name: Setup the gluster blick:s VG (LVM)
  lvol:
    vg: "{{ gluster.vg_name }}"
    lv: "{{ gluster.lv_name | default('glusterfs') }}"    
    size: "{{ gluster.size }}"
  when: gluster.vg_name is defined

- name: Make filesystem
  filesystem: fstype=xfs dev=/dev/mapper/{{ gluster.vg_name }}-{{ gluster.lv_name }}
  when: gluster.vg_name is defined

- name: Make gluster mount point
  file: path=/export/gluster state=directory

- name: Mount gluster volume
  mount:
    name: /export/gluster
    fstype: xfs
    src: /dev/mapper/{{ gluster.vg_name }}-{{ gluster.lv_name }}
    state: mounted
  when: gluster.vg_name is defined

- name: Open firewall
  firewalld:
    port: "{{ item }}"
    permanent: true
    state: disabled
  with_items:
    - "24007/tcp"
    - "24009/tcp"
    - "24010/tcp"
